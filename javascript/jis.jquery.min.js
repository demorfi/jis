/*!
 * JiS is “Images slider for jQuery framework”.
 *
 * @author demorfi <demorfi@gmail.com>
 * @version 1.0
 * @source https://github.com/demorfi/jis
 * @license http://opensource.org/licenses/MIT Licensed under MIT License
 */
(function(b){b.fn.jis=function(c){var d=new a(this,c);d.init();return(d)};var a=function(d,c){this.version=1;this.options=b.extend(true,{title:true,effect:"random",row:3,cell:20,auto:true,speed:800,pause:3500,pauseHover:true,recursion:true,start:1,directionNav:true,controlNav:true,random:false,nextText:"Next",prevText:"Prev",width:false,height:false,callback:{init:b.noop,before:b.noop,after:b.noop,last:b.noop,first:b.noop},animate:{title:function(f){var e=b(f).css("bottom");b(f).css({opacity:0,bottom:0}).show().animate({opacity:1,bottom:e},this.getOption("speed"))}},"class":{wrapper:"jis-wrapper",title:"jis-title",direction:"jis-direction",directionNext:"jis-direction-next",directionPrev:"jis-direction-prev",control:"jis-control",controlList:"jis-control-list",selected:"jis-selected",init:"jis-init",loading:"jis-loading",last:"jis-slide-last",first:"jis-slide-first",recursion:"jis-slide-recursion",grid:"jis-grid",gridRow:"jis-grid-row",gridCell:"jis-grid-cell"}},c);this.$el=b(d);return(this)};a.prototype={init:function(){var c=this;b.each(this.$el,function(){b(this).wrap(b("<div>").addClass(c.getClass("wrapper"))).show();var d=b(this).find("li"),f=d.size();b(this).data("slides",f);if(c.options.random){c.setOption("start",Math.floor(Math.random()*f))}var g=c.getOption("start")-1;d.hide().filter(":eq("+g+")").addClass(c.getClass("selected"));d.find("img:eq(0)").load(b.proxy(function(l,i,m,k){i.filter(":eq("+m+")").show();b(this).addClass(l.getClass("loading"));var j=l.getOption("width")?l.getOption("width"):b(k.currentTarget).width(),h=l.getOption("height")?l.getOption("height"):b(k.currentTarget).height();if(j&&h){b(this).css({width:j,height:h});b(this).parent().css({width:j,height:h})}},this,c,d,g));b(this).data("slideStart",g).data("slideCurrent",g);var e=b(this).parent();(g<1)&&e.addClass(c.getClass("first"));(g>=(f-1))&&e.addClass(c.getClass("last"));c.getOption("recursion")&&e.addClass(c.getClass("recursion"));c.build(this);c.getOption("auto")&&c.actionStart(this);c.getCallback("init").call(c,this)})},build:function(d){var c={};this.getOption("title")&&(c.title=this.buildTitle(d));this.getOption("directionNav")&&this.buildDirection(d);this.getOption("controlNav")&&(c.control=this.buildControl(d));b(d).data("slideTrigger",c).addClass(this.getClass("init"));if(this.getOption("pauseHover")){b(d).hover(b.proxy(function(e){b(e).data("slideHover",true)},this,d),b.proxy(function(e){b(e).removeData("slideHover")},this,d))}b(d).data("jisObject",this)},buildTitle:function(d){var e=this;b(d).find("li img").each(function(){var f=b(this).attr("alt");if(f){b(this).closest("li").append(b("<div>").addClass(e.getClass("title")).text(f).hide())}});var c=("li"+this.getClass("selected",true)+" "+this.getClass("title",true));b(d).find(c).show();return(b.proxy(function(i,f,g,j,h){this.getAnimate("title").call(this,b(i).find(f));b(h).find(this.getClass("title",true)).hide()},this,d,c))},buildDirection:function(d){var c=this.getOption("directionNav");var e={};if(!b.isEmptyObject(c)){for(var f in c){if(c.hasOwnProperty(f)){e[f]=c[f].indexOf("#")!==-1?b(c[f]):b(d).parent().find(c[f])}}}else{e.next=b("<div>").addClass(this.getClass("directionNext")).text(this.getOption("nextText"));e.prev=b("<div>").addClass(this.getClass("directionPrev")).text(this.getOption("prevText"));b(d).after(b("<div>").addClass(this.getClass("direction")).append(e.next).append(e.prev))}e.next.on("click.jisDirectionNext",b.proxy(this.slideNext,this,d));e.prev.on("click.jisDirectionPrev",b.proxy(this.slidePrev,this,d));b(d).data("directionNav",e)},buildControl:function(e){var g=b("<div>").addClass(this.getClass("controlList")),f=b(e).find("li").size();var c=b.proxy(function(i){var h=this.getCurrentIndex(i);b(i).parent().find(this.getClass("control",true)+" a").removeClass(this.getClass("selected")).filter('[rel="'+h+'"]').addClass(this.getClass("selected"))},this,e);for(var d=0;d<f;d++){g.append(b("<a>").attr("rel",d))}g.find("a").on("click.jisControl",b.proxy(this.slideControl,this,e,c)).filter(":eq("+(this.getOption("start")-1)+")").addClass(this.getClass("selected"));b(e).after(b("<div>").addClass(this.getClass("control")).append(g)).data("controlNav",g.find("a"));return(c)},getClass:function(d,c){return((c?".":"")+this.options["class"][d])},getCallback:function(c){return(b.isFunction(this.options.callback[c])?this.options.callback[c]:b.noop)},getOption:function(c){return(this.options[c])},setOption:function(c,d){this.options[c]=d},getVersion:function(){return(this.version)},getAnimate:function(c){return(b.isFunction(this.options.animate[c])?this.options.animate[c]:b.noop)},actionStart:function(c){if(!b(c).data("interval")){b(c).data("interval",setInterval(b.proxy(function(d){if(!b(d).data("slideHover")&&!b(d).data("slideAnimate")){b(d).parent().find(this.getClass("directionNext",true)).trigger("click.jisDirectionNext")}},this,c),this.getOption("speed")+this.getOption("pause")))}},actionStop:function(c){b(c).data("interval")&&clearInterval(b(c).data("interval"))},slideNext:function(g,e){g=this.getSliderLink(g);var d=this.getCurrentIndex(g),f=this.getSlideCount(g)-1,c=this.getOption("recursion");this.slideEq(g,(d>=f?(c?0:d):(d+1)),e)},slidePrev:function(g,e){g=this.getSliderLink(g);var d=this.getCurrentIndex(g),f=this.getSlideCount(g)-1,c=this.getOption("recursion");this.slideEq(g,(d<1?(c?f:d):(d-1)),e)},slideControl:function(e,c,d){d.currentTarget&&this.slideEq(e,parseInt(b(d.currentTarget).attr("rel")),c)},slideEq:function(c,i,d){c=this.getSliderLink(c);var k=this.getCurrentIndex(c),h=b(c).data("slides");if(i!=k&&!b(c).data("slideAnimate")){var j=b(c).find("li:eq("+k+")");var f=b(c).find("li:eq("+i+")");if(!b.isEmptyObject(j)&&!b.isEmptyObject(f)&&j.length&&f.length){var l=this.getEffect();if(b.isFunction(l)){this.getCallback("before").call(this,c,j,f,d);var g=b(c).parent();g.removeClass(this.getClass("first")+" "+this.getClass("last"));(i<1)&&g.addClass(this.getClass("first"));(i>=(h-1))&&g.addClass(this.getClass("last"));b(c).data("slideAnimate",true);var e={speed:this.getOption("speed"),cell:this.getOption("cell"),row:this.getOption("row"),current:{width:b(j).outerWidth(),height:b(j).height(),offset:b(j).outerHeight(),src:b(j).find("img").attr("src")},next:{width:b(f).outerWidth(),height:b(f).height(),offset:b(f).outerHeight(),src:b(f).find("img").attr("src")}};l.call(this,j,f,e);setTimeout(b.proxy(function(s,r,t,p){var m=b(s).data("slideTrigger"),o=b(s).find("li").index(t),q=b(s).data("slides");b(r).removeClass(this.getClass("selected")).hide();b(t).addClass(this.getClass("selected")).show();b(s).data("slideCurrent",o);if(!b.isEmptyObject(m)){for(var n in m){if(m.hasOwnProperty(n)&&b.isFunction(m[n])){m[n].call(this,s,t,r)}}}b.isFunction(p)&&p.call(this,s,t,r);this.getCallback("after").call(this,s,r,t,p);(o<1)&&this.getCallback("first").call(this,s,r,t,p);(o>=(q-1))&&this.getCallback("last").call(this,s,r,t,p);b(s).removeData("slideAnimate");this.actionStop(s);this.actionStart(s)},this,c,j,f,d),this.getOption("speed"))}}}},getSliderLink:function(c){return(!c?this.$el:c)},getCurrentIndex:function(c){return(b(c).data("slideCurrent"))},getSlideCount:function(c){return(b(c).data("slides"))},getEffect:function(){var c=this.getOption("effect");if(!b.isFunction(c)){var d=this.getEffectList();if(b.inArray(c,d)){return(this.effect[c])}return(this.effect[d[0]])}return(c)},getEffectList:function(){var c=[],e=["random","selectRandom","randomSlide","randomStrips","slideX","slideY","strips"];for(var d in this.effect){if(this.effect.hasOwnProperty(d)&&b.inArray(d,e)===-1){c.push(d)}}return(c)},saveStyle:function(e,d){if(b(e).length&&!b.isEmptyObject(d)){var f={};for(var c in d){if(d.hasOwnProperty(c)){f[d[c]]=b(e).css(d[c])}}b(e).data("saveStyle",f)}},restoreStyle:function(e){if(b(e).length&&b(e).data("saveStyle")){var d=b(e).data("saveStyle");for(var c in d){if(d.hasOwnProperty(c)){b(e).css(c,d[c])}}}},createGrid:function(d,n,k,l,o){var c=b("<div>").addClass(this.getClass("grid")).css({position:"absolute",left:0,top:0,right:0,width:d,display:"table"}),f=0,e=0,h=0,g=0;do{var p=b("<div>").addClass(this.getClass("gridRow")).css("display","table-row");do{var m=b("<div>").addClass(this.getClass("gridCell")).width(d).height(n);l&&b(m).height(n/l);k&&b(m).width(d/k);o&&b(m).css({"background-image":"url("+o+")","background-position":(-e+"px ")+(-f+"px ")});b(m).css({display:b.support.radioValue?"inline-block":"table-cell",position:"relative"});p.append(m);e+=k?(d/k):d;g++}while(g<k);c.append(p);f+=l?(n/l):n;h++;g=0}while(h<l);return(c)},sortRandom:function(d){var c=[],f=this.getEffectList();for(var e=0;e<f.length;e++){if(f[e].indexOf(d)!==-1&&f[e]!==d){c.push(f[e])}}return(c[Math.floor(Math.random()*c.length)])},effect:{random:function(e,c,f){var d=this.getEffectList();return(this.effect[d[Math.floor(Math.random()*d.length)]].call(this,e,c,f))},selectRandom:function(g,e,h){var c=this.getOption("select");if(c){c=c.split(",");if(c.length){var d=c[Math.floor(Math.random()*c.length)],f=this.getEffectList();if(b.inArray(d,f)!==-1){return(this.effect[d].call(this,g,e,h))}}}return(this.effect.random.call(this,g,e,h))},randomSlide:function(d,c,e){return(this.effect[this.sortRandom("slide")].call(this,d,c,e))},randomStrips:function(d,c,e){return(this.effect[this.sortRandom("strips")].call(this,d,c,e))},fade:function(d,c,e){b(d).fadeOut(e.speed);this.saveStyle(c,["position"]);b(c).css("position","absolute").fadeIn(e.speed,b.proxy(function(f){this.restoreStyle(f)},this,c))},slideX:function(e,d,f,c){this.saveStyle(d,["position","top","z-index","height"]);this.saveStyle(e,["margin-left"]);b(d).css({position:"absolute",top:0,height:f.current.offset,"z-index":(parseInt(b(e).css("z-index"))-1)}).show();b(e).stop().animate({"margin-left":c},f.speed,b.proxy(function(g,h){b(g).hide();this.restoreStyle(h);this.restoreStyle(g)},this,e,d))},slideY:function(e,d,f,g){this.saveStyle(d,["position",g,"z-index","height"]);var c={css:{position:"absolute",height:f.current.offset,"z-index":(parseInt(b(d).css("z-index"))+1)},animate:{}};c.css[g]=-f.current.height;c.animate[g]=f.current.height-f.current.offset;b(d).css(c.css).show().animate(c.animate,f.speed,b.proxy(function(h,i){b(h).hide();this.restoreStyle(i)},this,e,d))},slideUp:function(d,c,e){this.effect.slideY.call(this,d,c,e,"bottom")},slideDown:function(d,c,e){this.effect.slideY.call(this,d,c,e,"top")},slideLeft:function(d,c,e){this.effect.slideX.call(this,d,c,e,-e.current.width)},slideRight:function(d,c,e){this.effect.slideX.call(this,d,c,e,e.current.width)},strips:function(f,d,g,c,e){if(!b(f).find("img").length||!b(d).find("img").length){return(this.effect.random.call(this,f,d,g))}var h=b(d).css("z-index");this.saveStyle(f,["z-index"]);b(f).find("img, div").hide().end().append(c).css("z-index",parseInt(h)+2);this.saveStyle(d,["position","z-index"]);b(d).css({position:"absolute","z-index":parseInt(h)+1}).show();b(e).each(function(j){b(this).delay(((g.speed/g.cell)*j)/2).animate({opacity:0},(g.speed/g.cell)*((g.cell/2)))});setTimeout(b.proxy(function(j,k,i){i.remove();b(j).find("img, div").show();this.restoreStyle(j);this.restoreStyle(k)},this,f,d,c),g.speed)},stripsRight:function(f,e,g){var d=g.current,c=this.createGrid(d.width,d.height,g.cell,0,d.src);this.effect.strips.call(this,f,e,g,c,b(c).find(this.getClass("gridCell",true)))},stripsLeft:function(g,f,h){var e=h.current,d=this.createGrid(e.width,e.height,h.cell,0,e.src),c=b(b(d).find(this.getClass("gridCell",true)).toArray().reverse());this.effect.strips.call(this,g,f,h,d,c)},eraser:function(g,e,h){if(!b(g).find("img").length||!b(e).find("img").length){return(this.effect.random.call(this,g,e,h))}this.setOption("speed",h.speed*((h.cell/h.row)/2));var f=this.getOption("speed"),d=h.current,c=this.createGrid(d.width,d.height,h.cell,0,d.src),i=b(e).css("z-index");this.saveStyle(g,["z-index"]);b(g).find("img, div").hide().end().append(c).css("z-index",parseInt(i)+2);this.saveStyle(e,["position","z-index"]);b(e).css({position:"absolute","z-index":parseInt(i)+1}).show();b(c).find(this.getClass("gridCell",true)).each(function(l){var k={},j=(l%2)?"top":"bottom";k[j]=-d.height;b(this).delay(((f/h.cell)*l)/2).animate(k,(f/h.cell)*((h.cell/2)))});setTimeout(b.proxy(function(k,l,j,m){j.remove();b(k).css("z-index",1).find("img, div").show();this.restoreStyle(k);this.restoreStyle(l);this.setOption("speed",m.speed)},this,g,e,c,h),f)}}};b(function(){b(".jis-trigger").jis()})})(jQuery);